<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 æ²–ç¹©è¦ªå­äº”æ—¥éŠ</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <!-- ç¢ºä¿è·¯å¾‘æ­£ç¢ºï¼ŒåŠ å…¥æ™‚é–“æˆ³è¨˜é˜²æ­¢å¿«å– -->
    <script src="data.js?v=20260208_final"></script>
    <script src="prompts.js?v=20260208_final"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #f1f5f9; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.4s ease-out; }
        .day-card { display: none; }
        .day-card.active { display: block; animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .timeline-container { position: relative; padding-left: 28px; margin-left: 4px; }
        .timeline-container::before { content: ''; position: absolute; left: 0; top: 6px; bottom: 6px; width: 2px; background: #e2e8f0; border-radius: 1px; }
        .timeline-item { position: relative; padding-bottom: 24px; }
        .timeline-dot { position: absolute; left: -33px; top: 6px; width: 12px; height: 12px; border: 2px solid #fff; border-radius: 50%; z-index: 10; }
        .timeline-time { display: block; font-size: 0.8rem; font-weight: 700; color: #2563eb; margin-bottom: 2px; }
        .timeline-title { font-weight: 700; color: #1e293b; font-size: 1.05rem; margin-bottom: 4px; display: flex; align-items: center; flex-wrap: wrap; }
        .timeline-desc { font-size: 0.85rem; color: #64748b; line-height: 1.6; }
        
        .action-btn { font-size: 10px; padding: 4px 8px; border-radius: 6px; margin-left: 6px; display: inline-flex; align-items: center; }
        .nav-btn { background-color: #dcfce7; color: #15803d; }
        .detail-btn { background-color: #e0f2fe; color: #0369a1; }
        
        .parent-tip { background: #fff7ed; border-left: 4px solid #f97316; padding: 8px; border-radius: 4px; margin-top: 8px; }
        .day-card-enhanced { background-color: white; border-radius: 1.5rem; padding: 1.5rem; border: 1px solid #f1f5f9; box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1); }
        .checklist-item { display: flex; align-items: center; padding: 8px 16px; cursor: pointer; }
    </style>
</head>
<body class="pb-24">

    <header class="bg-blue-600 text-white shadow-lg sticky top-0 z-50">
        <div class="max-w-md mx-auto px-4 pt-4 pb-2">
            <div class="flex justify-between items-center mb-4">
                <h1 id="header-title" class="text-xl font-bold">ğŸŒ¸ æ²–ç¹©è¦ªå­éŠ ğŸŒ¸</h1>
                <button onclick="toggleAIChat()" class="bg-white/20 p-2 rounded-full"><i class="fas fa-robot text-sm"></i></button>
            </div>
            <div class="flex bg-blue-700/50 rounded-xl p-1 mb-2">
                <button onclick="switchMainTab('itinerary')" id="main-tab-itinerary" class="flex-1 py-2 text-sm font-bold rounded-lg bg-white text-blue-700 shadow-sm">è¡Œç¨‹è¦åŠƒ</button>
                <button onclick="switchMainTab('preparation')" id="main-tab-preparation" class="flex-1 py-2 text-sm font-bold rounded-lg text-white">è¡Œå‰æº–å‚™</button>
                <button onclick="switchMainTab('notes')" id="main-tab-notes" class="flex-1 py-2 text-sm font-bold rounded-lg text-white">æ³¨æ„äº‹é …</button>
            </div>
        </div>
    </header>

    <main class="max-w-md mx-auto p-4">
        <!-- è¼‰å…¥ä¸­æç¤º -->
        <div id="loading-spinner" class="py-20 text-center">
            <i class="fas fa-circle-notch animate-spin text-3xl text-blue-500 mb-4"></i>
            <p class="text-gray-500 text-sm">æ­£åœ¨è¼‰å…¥è¡Œç¨‹è³‡æ–™...</p>
        </div>

        <div id="content-itinerary" class="tab-content">
            <div id="logistics-container" class="bg-white rounded-xl p-3 shadow-sm mb-4 border border-blue-100 text-[10px]"></div>
            <div id="day-selector" class="flex space-x-2 mb-6 overflow-x-auto pb-2 no-scrollbar text-xs"></div>
            <div id="days-container"></div>
        </div>
        <div id="content-preparation" class="tab-content">
            <div id="preparation-list" class="space-y-6"></div>
        </div>
        <div id="content-notes" class="tab-content">
            <div id="notes-list" class="space-y-4"></div>
        </div>
    </main>

    <!-- æ™¯é»è©³æƒ…å½ˆçª— -->
    <div id="detail-modal" class="fixed inset-0 bg-black/60 z-[70] hidden flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-md rounded-3xl shadow-2xl overflow-hidden flex flex-col max-h-[90vh]">
            <div class="p-5 overflow-y-auto space-y-5" id="detail-body">
                <!-- å…§å®¹å‹•æ…‹ç”Ÿæˆ -->
            </div>
            <div class="p-4 border-t bg-slate-50 text-right">
                <button onclick="closeDetail()" class="text-blue-600 font-bold px-4 py-2">é—œé–‰</button>
            </div>
        </div>
    </div>

    <!-- AI åŠ©æ‰‹å½ˆçª— -->
    <div id="ai-modal" class="fixed inset-0 bg-black/50 z-[60] hidden flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-sm rounded-2xl shadow-2xl flex flex-col max-h-[80vh]">
            <div class="p-4 border-b flex justify-between items-center bg-purple-600 text-white rounded-t-2xl">
                <div class="flex items-center space-x-2"><i class="fas fa-robot"></i><h3 class="font-bold text-sm">æ²–ç¹©æ—…éŠåŠ©æ‰‹</h3></div>
                <button onclick="toggleAIChat()"><i class="fas fa-times"></i></button>
            </div>
            <div id="ai-response-container" class="p-4 overflow-y-auto flex-grow text-[11px] text-gray-700 space-y-3"></div>
            <div class="p-4 border-t bg-gray-50 rounded-b-2xl">
                <form onsubmit="event.preventDefault(); handleCustomQuery();" class="flex space-x-2">
                    <input id="ai-input" type="text" placeholder="æœ‰ä»€éº¼å•é¡Œå—ï¼Ÿ" class="flex-grow border rounded-xl px-4 py-2 text-sm">
                    <button type="submit" class="bg-purple-600 text-white px-4 py-2 rounded-xl text-sm font-bold">å‚³é€</button>
                </form>
            </div>
        </div>
    </div>

    <script>
        // æ ¸å¿ƒè³‡æ–™è®€å–é‚è¼¯
        function getTripData() {
            // åŒæ™‚æª¢æŸ¥æ‰€æœ‰å¯èƒ½çš„è®Šæ•¸åç¨±
            const data = window.travelData || window.okinawaTripData2026 || window.okinawaTripData;
            return data;
        }

        function renderApp() {
            const data = getTripData();
            
            // å¦‚æœé‚„æ²’æ‹¿åˆ°è³‡æ–™ï¼Œé¡¯ç¤ºè¼‰å…¥ä¸­ä¸¦å»¶é²é‡è©¦
            if (!data) {
                console.log("è³‡æ–™å°šæœªå°±ç·’ï¼Œ0.5ç§’å¾Œé‡è©¦...");
                setTimeout(renderApp, 500);
                return;
            }

            // éš±è—è¼‰å…¥æç¤ºï¼Œé¡¯ç¤ºå…§å®¹å€
            document.getElementById('loading-spinner').classList.add('hidden');
            document.getElementById('content-itinerary').classList.add('active');

            // 1. æ›´æ–°æ¨™é¡Œ
            if (data.metadata?.title) document.getElementById('header-title').innerText = data.metadata.title;

            // 2. ç‰©æµè³‡è¨Š
            const logBox = document.getElementById('logistics-container');
            const logistics = data.metadata?.logistics || [];
            logBox.innerHTML = `<div class="grid grid-cols-2 gap-2">${logistics.map(l => `<span><i class="fas ${l.icon} mr-1 text-blue-500"></i> ${l.text}</span>`).join('')}</div>`;

            // 3. è¡Œç¨‹æ¸²æŸ“
            const daysContainer = document.getElementById('days-container');
            const daySelector = document.getElementById('day-selector');
            const days = data.itinerary?.days || (Array.isArray(data.itinerary) ? data.itinerary : []);

            days.forEach((dayObj, index) => {
                // ç”Ÿæˆä¸Šæ–¹æ—¥æœŸæŒ‰éˆ•
                const btn = document.createElement('button');
                btn.id = `btn-${dayObj.day}`;
                btn.onclick = () => showDay(dayObj.day);
                btn.className = `day-btn flex-shrink-0 w-20 py-2 rounded-xl text-center transition ${index === 0 ? 'bg-blue-600 text-white shadow-md' : 'bg-white text-gray-600 border border-gray-100'}`;
                btn.innerHTML = `<div class="font-bold">Day ${dayObj.day}</div><div class="text-[9px] opacity-80">${dayObj.date}</div>`;
                daySelector.appendChild(btn);

                // ç”Ÿæˆç•¶æ—¥è¡Œç¨‹å¡ç‰‡
                const card = document.createElement('div');
                card.id = `day-${dayObj.day}`;
                card.className = `day-card ${index === 0 ? 'active' : ''}`;
                
                const events = dayObj.events || dayObj.items || [];
                let itemsHtml = '';
                events.forEach(item => {
                    const title = item.activity || item.title;
                    const poi = (data.pois && item.poiId) ? data.pois[item.poiId] : null;
                    const navUrl = `https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(poi?.navName || title)}`;
                    
                    itemsHtml += `
                        <div class="timeline-item">
                            <div class="timeline-dot" style="background: #3b82f6;"></div>
                            <span class="timeline-time">${item.time}</span>
                            <h3 class="timeline-title">
                                ${title}
                                <a href="${navUrl}" target="_blank" class="action-btn nav-btn"><i class="fas fa-directions mr-1"></i>å°èˆª</a>
                                <button onclick='showDetail("${item.poiId || ''}", "${title}")' class="action-btn detail-btn"><i class="fas fa-info-circle mr-1"></i>è©³æƒ…</button>
                            </h3>
                            <p class="timeline-desc">${item.desc || poi?.desc || ""}</p>
                        </div>`;
                });
                
                card.innerHTML = `
                    <div class="mb-4 text-center"><span class="bg-blue-50 text-blue-700 px-3 py-1 rounded-full text-[10px] font-bold border border-blue-100">${dayObj.fullDate || dayObj.date}</span></div>
                    <div class="day-card-enhanced"><div class="timeline-container">${itemsHtml}</div></div>`;
                daysContainer.appendChild(card);
            });

            renderPreparation(data);
            renderNotes(data);
        }

        function showDetail(poiId, title) {
            const data = getTripData();
            const poi = data.pois?.[poiId];
            const body = document.getElementById('detail-body');
            
            let html = `<h2 class="text-xl font-bold text-gray-800 border-b pb-2">${title}</h2>`;
            
            if (poi) {
                if (poi.parentTips) {
                    html += `<div class="parent-tip"><div class="text-[10px] font-bold text-orange-600 mb-1"><i class="fas fa-baby mr-1"></i>è¦ªå­æé†’</div><div class="text-xs text-orange-800">${poi.parentTips}</div></div>`;
                }
                html += `<div class="text-sm text-gray-600 leading-relaxed">${poi.detailedStory || poi.desc || "æš«ç„¡è©³ç´°èªªæ˜"}</div>`;
                if (poi.infoSections) {
                    html += `<div class="grid grid-cols-2 gap-2">`;
                    poi.infoSections.forEach(s => {
                        html += `<div class="bg-gray-50 p-2 rounded-lg"><span class="block text-[10px] text-gray-400">${s.label}</span><span class="text-xs font-bold">${s.content}</span></div>`;
                    });
                    html += `</div>`;
                }
            } else {
                html += `<p class="text-sm text-gray-500 mt-4">æ›´å¤šè©³æƒ…è¦åŠƒä¸­...</p>`;
            }
            
            body.innerHTML = html;
            document.getElementById('detail-modal').classList.remove('hidden');
        }

        function renderPreparation(data) {
            const container = document.getElementById('preparation-list');
            if (!container || !data.preparation) return;
            container.innerHTML = data.preparation.map(group => `
                <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
                    <div class="bg-blue-50 px-4 py-3 border-b border-blue-100 font-bold text-blue-800">${group.category}</div>
                    <div class="p-2">
                        ${group.items.map(item => `<label class="checklist-item"><input type="checkbox" class="mr-3"><span class="text-sm text-gray-700">${item}</span></label>`).join('')}
                    </div>
                </div>`).join('');
        }

        function renderNotes(data) {
            const container = document.getElementById('notes-list');
            if (!container || !data.notes) return;
            container.innerHTML = data.notes.map(note => `
                <div class="bg-white p-5 rounded-2xl shadow-sm border border-gray-100">
                    <h3 class="font-bold text-blue-700 mb-3 border-b pb-2"><i class="fas ${note.icon} mr-2"></i>${note.title}</h3>
                    <ul class="text-xs text-gray-600 space-y-2">${note.content.map(li => `<li>â€¢ ${li}</li>`).join('')}</ul>
                </div>`).join('');
        }

        function showDay(d) {
            document.querySelectorAll('.day-card').forEach(c => c.classList.remove('active'));
            document.getElementById('day-' + d).classList.add('active');
            document.querySelectorAll('.day-btn').forEach(b => {
                b.classList.remove('bg-blue-600', 'text-white', 'shadow-md');
                b.classList.add('bg-white', 'text-gray-600');
            });
            document.getElementById('btn-' + d).classList.add('bg-blue-600', 'text-white', 'shadow-md');
        }

        function switchMainTab(t) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.getElementById('content-' + t).classList.add('active');
            ['itinerary', 'preparation', 'notes'].forEach(tab => {
                const btn = document.getElementById('main-tab-' + tab);
                if (tab === t) btn.classList.add('bg-white', 'text-blue-700');
                else btn.classList.remove('bg-white', 'text-blue-700');
            });
        }

        function closeDetail() { document.getElementById('detail-modal').classList.add('hidden'); }
        function toggleAIChat() { document.getElementById('ai-modal').classList.toggle('hidden'); }

        window.onload = renderApp;
    </script>
</body>
</html>
