<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ²–ç¹© 5 å¤© 4 å¤œè¦ªå­éŠ (2026/3/28èµ·)</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <!-- å¼•å…¥è³‡æ–™æª”æ¡ˆ -->
    <script src="data.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #f1f5f9; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.4s ease-out; }
        .day-card { display: none; }
        .day-card.active { display: block; animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .timeline-container { position: relative; padding-left: 28px; margin-left: 4px; }
        .timeline-container::before { content: ''; position: absolute; left: 0; top: 6px; bottom: 6px; width: 2px; background: #e2e8f0; border-radius: 1px; }
        .timeline-item { position: relative; padding-bottom: 24px; }
        .timeline-item:last-child { padding-bottom: 0; }
        .timeline-dot { position: absolute; left: -33px; top: 6px; width: 12px; height: 12px; background: #3b82f6; border: 2px solid #fff; border-radius: 50%; z-index: 10; }
        .timeline-time { display: block; font-size: 0.8rem; font-weight: 700; color: #2563eb; margin-bottom: 2px; letter-spacing: 0.025em; }
        .timeline-title { font-weight: 700; color: #1e293b; font-size: 1.05rem; margin-bottom: 4px; display: flex; align-items: center; flex-wrap: wrap; }
        .timeline-desc { font-size: 0.85rem; color: #64748b; line-height: 1.6; font-weight: 400; }
        .nav-btn { font-size: 10px; background-color: #dcfce7; color: #15803d; padding: 4px 8px; border-radius: 6px; margin-left: 8px; display: inline-flex; align-items: center; }
        .meal-tag { display: inline-block; background-color: #fef9c3; color: #854d0e; font-size: 10px; padding: 2px 8px; border-radius: 9999px; font-weight: 700; margin-bottom: 4px; }
        .breakfast-tag { display: inline-block; background-color: #fce7f3; color: #9d174d; font-size: 10px; padding: 2px 8px; border-radius: 9999px; font-weight: 700; margin-bottom: 4px; margin-right: 4px; }
        .coffee-break { background-color: #fffaf3; border: 1px dashed #fdba74; padding: 8px; border-radius: 8px; font-size: 11px; margin-top: 4px; color: #9a3412; }
        .checklist-item { display: flex; align-items: center; padding: 8px 16px; border-bottom: 1px solid #f1f5f9; cursor: pointer; }
        .checklist-item input { margin-right: 12px; width: 16px; height: 16px; accent-color: #2563eb; }
        .day-card-enhanced { background-color: white; border-radius: 1.5rem; padding: 1.5rem; border: 1px solid #f1f5f9; box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1); }
    </style>
</head>
<body class="pb-24">

    <!-- é é¦–èˆ‡å°è¦½ -->
    <header class="bg-blue-600 text-white shadow-lg sticky top-0 z-50">
        <div class="max-w-md mx-auto px-4 pt-4 pb-2">
            <div class="flex justify-between items-center mb-4">
                <h1 class="text-xl font-bold">ğŸŒ¸ æ²–ç¹©åˆèˆª ğŸŒ¸</h1>
                <div class="flex space-x-2">
                    <button onclick="setupApiKey()" class="bg-white/20 p-2 rounded-full"><i class="fas fa-key text-sm"></i></button>
                    <button onclick="toggleAIChat()" class="bg-white/20 p-2 rounded-full"><i class="fas fa-robot text-sm"></i></button>
                </div>
            </div>
            <div class="flex bg-blue-700/50 rounded-xl p-1 mb-2">
                <button onclick="switchMainTab('itinerary')" id="main-tab-itinerary" class="flex-1 py-2 text-sm font-bold rounded-lg bg-white text-blue-700 shadow-sm transition-all">è¡Œç¨‹è¦åŠƒ</button>
                <button onclick="switchMainTab('preparation')" id="main-tab-preparation" class="flex-1 py-2 text-sm font-bold rounded-lg text-white transition-all">è¡Œå‰æº–å‚™</button>
                <button onclick="switchMainTab('notes')" id="main-tab-notes" class="flex-1 py-2 text-sm font-bold rounded-lg text-white transition-all">æ³¨æ„äº‹é …</button>
            </div>
        </div>
    </header>

    <main class="max-w-md mx-auto p-4">
        
        <!-- [Tab 1] è¡Œç¨‹è¦åŠƒå€å¡Š -->
        <div id="content-itinerary" class="tab-content active">
            <!-- èˆªç­äº¤é€šè³‡è¨Š (å‹•æ…‹æ¸²æŸ“) -->
            <div id="logistics-container" class="bg-white rounded-xl p-3 shadow-sm mb-4 border border-blue-100 text-[10px]"></div>

            <!-- å¤©æ•¸åˆ‡æ›å™¨ (å‹•æ…‹æ¸²æŸ“) -->
            <div id="day-selector" class="flex space-x-2 mb-6 overflow-x-auto pb-2 no-scrollbar text-xs"></div>

            <!-- æ¯æ—¥è©³ç´°å¡ç‰‡ (å‹•æ…‹æ¸²æŸ“) -->
            <div id="days-container"></div>
        </div>

        <!-- [Tab 2] è¡Œå‰æº–å‚™å€å¡Š -->
        <div id="content-preparation" class="tab-content">
            <div id="preparation-container" class="space-y-6"></div>
        </div>

        <!-- [Tab 3] æ³¨æ„äº‹é …å€å¡Š -->
        <div id="content-notes" class="tab-content">
            <div id="notes-container" class="space-y-4"></div>
        </div>

    </main>

    <!-- é å°¾å°è¦½ -->
    <nav class="fixed bottom-0 left-0 right-0 bg-white border-t p-3 flex justify-around items-center max-w-md mx-auto shadow-2xl z-40">
        <button onclick="switchMainTab('itinerary')" class="text-center text-blue-600">
            <i class="fas fa-route block text-lg"></i>
            <span class="text-[10px] font-bold">è¡Œç¨‹</span>
        </button>
        <button onclick="toggleAIChat()" class="text-center text-purple-600">
            <i class="fas fa-comments block text-lg"></i>
            <span class="text-[10px] font-bold">å•åŠ©æ‰‹</span>
        </button>
    </nav>

    <!-- AI åŠ©æ‰‹å½ˆçª— -->
    <div id="ai-modal" class="fixed inset-0 bg-black/50 z-[60] hidden flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-sm rounded-2xl shadow-2xl flex flex-col max-h-[80vh]">
            <div class="p-4 border-b flex justify-between items-center bg-purple-600 text-white rounded-t-2xl">
                <div class="flex items-center space-x-2"><i class="fas fa-robot"></i><h3 class="font-bold text-sm">æ²–ç¹©æ—…éŠåŠ©æ‰‹</h3></div>
                <button onclick="toggleAIChat()"><i class="fas fa-times"></i></button>
            </div>
            <div id="ai-response-container" class="p-4 overflow-y-auto flex-grow text-sm text-gray-700 leading-relaxed">æ‚¨å¥½ï¼æ‚¨å¯ä»¥å•æˆ‘é—œæ–¼è¡Œç¨‹çš„å•é¡Œã€‚</div>
            <div id="ai-loading" class="hidden p-4 text-center text-purple-600 font-medium">åˆ†æä¸­...</div>
            <div class="p-4 border-t bg-gray-50 rounded-b-2xl">
                <div class="flex space-x-2">
                    <input id="ai-input" type="text" placeholder="è¼¸å…¥å•é¡Œ..." class="flex-grow border rounded-xl px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-purple-500">
                    <button onclick="handleCustomQuery()" class="bg-purple-600 text-white px-4 py-2 rounded-xl text-sm font-bold">å‚³é€</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        /**
         * æ¸²æŸ“å¼•æ“ï¼šå°‡ data.js çš„å…§å®¹å‹•æ…‹æ”¾å…¥ HTML
         */
        function renderApp() {
            const data = okinawaTripData;

            // 1. æ¸²æŸ“èˆªç­èˆ‡äº¤é€š
            const logContainer = document.getElementById('logistics-container');
            logContainer.innerHTML = `
                <div class="flex justify-between mb-1">
                    <span><i class="fas fa-plane-departure mr-1"></i> ${data.logistics.departure.flight} (${data.logistics.departure.route})</span>
                    <span><i class="fas fa-taxi mr-1"></i> ${data.logistics.departure.car}</span>
                </div>
                <div class="flex justify-between">
                    <span><i class="fas fa-plane-arrival mr-1"></i> ${data.logistics.return.flight} (${data.logistics.return.route})</span>
                    <span><i class="fas fa-taxi mr-1"></i> ${data.logistics.return.car}</span>
                </div>
            `;

            // 2. æ¸²æŸ“å¤©æ•¸åˆ‡æ›æŒ‰éˆ•èˆ‡å¡ç‰‡
            const daySelector = document.getElementById('day-selector');
            const daysContainer = document.getElementById('days-container');
            
            data.days.forEach((dayObj, index) => {
                const isActive = index === 0;
                // æŒ‰éˆ•
                const btn = document.createElement('button');
                btn.id = `btn-${dayObj.day}`;
                btn.onclick = () => showDay(dayObj.day);
                btn.className = `day-btn flex-shrink-0 w-20 py-2 rounded-lg text-center ${isActive ? 'bg-blue-600 text-white shadow-md' : 'bg-white text-gray-600 border border-gray-200'}`;
                btn.innerHTML = `<div class="font-bold">${dayObj.title}</div><div class="text-[9px] opacity-80">${dayObj.date}</div>`;
                daySelector.appendChild(btn);

                // å¡ç‰‡
                const card = document.createElement('div');
                card.id = `day-${dayObj.day}`;
                card.className = `day-card ${isActive ? 'active' : ''}`;
                
                let timelineItemsHtml = '';
                dayObj.items.forEach(item => {
                    const dotColor = item.type === 'attraction' ? '#10b981' : (item.type === 'meal' ? '#f59e0b' : '#3b82f6');
                    timelineItemsHtml += `
                        <div class="timeline-item">
                            <div class="timeline-dot" style="background: ${dotColor};"></div>
                            <span class="timeline-time">${item.time}</span>
                            <h3 class="timeline-title">
                                ${item.tag ? `<div class="breakfast-tag">æ¨è–¦ï¼š${item.tag}</div>` : ''}
                                ${item.title}
                                ${item.nav ? `<a href="${item.nav}" target="_blank" class="nav-btn"><i class="fas fa-map-marker-alt mr-1"></i>å°èˆª</a>` : ''}
                            </h3>
                            ${item.mealTag ? `<div class="meal-tag">${item.mealTag}</div>` : ''}
                            <p class="timeline-desc">${item.desc}</p>
                            ${item.coffeeBreak ? `<div class="coffee-break"><i class="fas fa-star mr-2 text-orange-400"></i><strong>${item.coffeeBreak}</strong></div>` : ''}
                        </div>
                    `;
                });

                card.innerHTML = `
                    <div class="mb-4 text-center"><span class="bg-blue-50 text-blue-700 px-3 py-1 rounded-full text-xs font-bold border border-blue-100">${dayObj.fullDate}</span></div>
                    <div class="day-card-enhanced"><div class="timeline-container">${timelineItemsHtml}</div></div>
                `;
                daysContainer.appendChild(card);
            });

            // 3. æ¸²æŸ“è¡Œå‰æº–å‚™
            const prepContainer = document.getElementById('preparation-container');
            data.preparation.forEach(p => {
                const colors = { blue: 'bg-blue-50 text-blue-800 border-blue-100', pink: 'bg-pink-50 text-pink-800 border-pink-100', green: 'bg-green-50 text-green-800 border-green-100' };
                prepContainer.innerHTML += `
                    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
                        <div class="${colors[p.style]} px-4 py-3 border-b font-bold flex justify-between items-center">
                            <span>${p.category}</span>
                            ${p.badge ? `<span class="text-[10px] bg-blue-200 text-blue-700 px-2 py-0.5 rounded">${p.badge}</span>` : ''}
                        </div>
                        <div class="p-2">
                            ${p.tip ? `<p class="px-4 py-2 text-xs text-gray-500 italic">${p.tip}</p>` : ''}
                            ${p.items.map(i => `<label class="checklist-item"><input type="checkbox"> <span class="text-sm">${i}</span></label>`).join('')}
                        </div>
                    </div>
                `;
            });

            // 4. æ¸²æŸ“æ³¨æ„äº‹é …
            const notesContainer = document.getElementById('notes-container');
            data.notes.forEach(n => {
                const colors = { blue: 'text-blue-700 border-blue-100', green: 'text-green-700 border-green-100', orange: 'text-orange-700 border-orange-100' };
                notesContainer.innerHTML += `
                    <div class="bg-white p-5 rounded-2xl shadow-sm border border-gray-100">
                        <h3 class="font-bold ${colors[n.style]} mb-3 border-b pb-2 flex items-center">
                            <i class="fas ${n.icon} mr-2"></i> ${n.title}
                        </h3>
                        <ul class="text-xs text-gray-600 space-y-3 leading-relaxed">
                            ${n.content.map(c => `<li>${c}</li>`).join('')}
                        </ul>
                    </div>
                `;
            });
        }

        /**
         * åŸºç¤é‚è¼¯ï¼šåˆ‡æ›èˆ‡ API
         */
        let currentApiKey = localStorage.getItem('GEMINI_API_KEY') || "";

        function switchMainTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.getElementById('content-' + tabId).classList.add('active');
            ['itinerary', 'preparation', 'notes'].forEach(t => {
                const btn = document.getElementById('main-tab-' + t);
                if (t === tabId) { btn.classList.add('bg-white', 'text-blue-700'); btn.classList.remove('text-white'); }
                else { btn.classList.remove('bg-white', 'text-blue-700'); btn.classList.add('text-white'); }
            });
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function showDay(day) {
            document.querySelectorAll('.day-card').forEach(c => c.classList.remove('active'));
            document.getElementById('day-' + day).classList.add('active');
            document.querySelectorAll('.day-btn').forEach(b => {
                b.classList.remove('bg-blue-600', 'text-white', 'shadow-md');
                b.classList.add('bg-white', 'text-gray-600', 'border', 'border-gray-200');
            });
            const targetBtn = document.getElementById('btn-' + day);
            targetBtn.classList.add('bg-blue-600', 'text-white', 'shadow-md');
            targetBtn.classList.remove('bg-white', 'text-gray-600');
        }

        function setupApiKey() {
            const key = prompt("è¼¸å…¥ Gemini API Key:", currentApiKey);
            if (key !== null) { currentApiKey = key.trim(); localStorage.setItem('GEMINI_API_KEY', currentApiKey); }
        }

        function toggleAIChat() { document.getElementById('ai-modal').classList.toggle('hidden'); }

        async function askGemini(query) {
            const container = document.getElementById('ai-response-container');
            const loading = document.getElementById('ai-loading');
            if (!currentApiKey) { container.innerHTML = "è«‹å…ˆè¨­ç½® API Keyã€‚"; return; }
            loading.classList.remove('hidden');
            try {
                const currentContent = JSON.stringify(okinawaTripData);
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${currentApiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: `è³‡æ–™ï¼š${currentContent}\næå•ï¼š${query}` }] }],
                        systemInstruction: { parts: [{ text: "ä½ æ˜¯æ²–ç¹©å°éŠï¼Œæ ¹æ“šè³‡æ–™å›ç­”ä½¿ç”¨è€…ã€‚" }] }
                    })
                });
                const data = await response.json();
                const text = data.candidates?.[0]?.content?.parts?.[0]?.text || "ç„¡æ³•å›æ‡‰ã€‚";
                container.innerHTML = text.replace(/\n/g, '<br>').replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            } catch (e) { container.innerHTML = "éŒ¯èª¤ï¼Œè«‹æª¢æŸ¥ APIã€‚"; } finally { loading.classList.add('hidden'); }
        }

        function handleCustomQuery() {
            const input = document.getElementById('ai-input');
            if (input.value) { askGemini(input.value); input.value = ''; }
        }

        // åˆå§‹åŒ–æ¸²æŸ“
        window.onload = renderApp;
    </script>
</body>
</html>
